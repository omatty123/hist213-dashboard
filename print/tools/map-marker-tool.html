<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Map Marker Tool - Click to Place</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { font-size: 18px; margin-bottom: 8px; }
    .subtitle { color: #666; font-size: 12px; margin-bottom: 16px; }

    .controls {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    label { font-size: 12px; font-weight: 600; }
    input[type="file"] { font-size: 12px; }
    input[type="text"] {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 12px;
      width: 300px;
    }
    button {
      padding: 6px 12px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    button:hover { background: #555; }
    button.danger { background: #c00; }
    button.danger:hover { background: #a00; }
    button.success { background: #070; }
    button.success:hover { background: #050; }

    .workspace {
      display: flex;
      gap: 20px;
    }

    .map-area {
      flex: 1;
    }
    .map-container {
      position: relative;
      display: inline-block;
      border: 2px solid #333;
      background: #fff;
      cursor: crosshair;
    }
    .map-img {
      display: block;
      max-width: 700px;
      max-height: 80vh;
    }
    .placeholder {
      width: 500px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 14px;
      background: #fafafa;
    }

    .marker {
      position: absolute;
      width: 24px;
      height: 24px;
      background: #c00;
      border: 2px solid #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      cursor: move;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      z-index: 10;
    }
    .marker:hover {
      background: #f00;
      transform: translate(-50%, -50%) scale(1.1);
    }
    .marker.dragging {
      opacity: 0.7;
    }

    .sidebar {
      width: 350px;
      background: #fff;
      border-radius: 8px;
      padding: 16px;
    }
    .sidebar h2 { font-size: 14px; margin-bottom: 12px; }

    .marker-list {
      margin-bottom: 16px;
      max-height: 300px;
      overflow-y: auto;
    }
    .marker-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      font-size: 12px;
    }
    .marker-num {
      width: 20px;
      height: 20px;
      background: #c00;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      flex-shrink: 0;
    }
    .marker-item input {
      flex: 1;
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 3px;
      font-size: 11px;
    }
    .marker-coords {
      font-family: monospace;
      font-size: 10px;
      color: #666;
      white-space: nowrap;
    }
    .marker-delete {
      background: none;
      border: none;
      color: #c00;
      cursor: pointer;
      font-size: 14px;
      padding: 2px 6px;
    }

    .output-section { margin-top: 16px; }
    .output-section h3 { font-size: 12px; margin-bottom: 8px; }
    .output-box {
      background: #1a1a1a;
      color: #0f0;
      padding: 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 11px;
      white-space: pre-wrap;
      max-height: 250px;
      overflow-y: auto;
    }

    .instructions {
      margin-top: 16px;
      padding: 12px;
      background: #fffbe6;
      border: 1px solid #ffe066;
      border-radius: 4px;
      font-size: 11px;
    }
    .instructions strong { display: block; margin-bottom: 4px; }
    .instructions ul { margin-left: 16px; }
    .instructions li { margin: 2px 0; }
  </style>
</head>
<body>
  <h1>Map Marker Tool</h1>
  <p class="subtitle">Click on the map to place numbered markers. Drag markers to adjust. Export CSS when done.</p>

  <div class="controls">
    <div class="control-group">
      <label>Load Image:</label>
      <input type="file" id="imageInput" accept="image/*">
    </div>
    <div class="control-group">
      <label>Or URL:</label>
      <input type="text" id="imageUrl" placeholder="https://example.com/map.png">
      <button id="loadUrl">Load</button>
    </div>
    <div class="control-group">
      <button id="loadEastAsia">Load East Asia</button>
      <button id="loadKorea">Load Korea Political</button>
      <button id="loadKoreaBlank">Load Korea Blank</button>
    </div>
    <button id="clearAll" class="danger">Clear All Markers</button>
    <button id="copyCSS" class="success">Copy CSS</button>
  </div>

  <div class="workspace">
    <div class="map-area">
      <div class="map-container" id="mapContainer">
        <div class="placeholder" id="placeholder">Load an image to begin</div>
      </div>
    </div>

    <div class="sidebar">
      <h2>Markers</h2>
      <div class="marker-list" id="markerList">
        <p style="color: #999; font-size: 12px;">Click on the map to add markers</p>
      </div>

      <div class="output-section">
        <h3>CSS Output</h3>
        <div class="output-box" id="cssOutput"><!-- CSS will appear here --></div>
      </div>

      <div class="instructions">
        <strong>How to use:</strong>
        <ul>
          <li>Load your map image</li>
          <li>Click on each location to place a marker</li>
          <li>Enter a label for each marker</li>
          <li>Drag markers to fine-tune position</li>
          <li>Copy the CSS and paste into your HTML</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const container = document.getElementById('mapContainer');
    const placeholder = document.getElementById('placeholder');
    const markerList = document.getElementById('markerList');
    const cssOutput = document.getElementById('cssOutput');

    let markers = [];
    let mapImg = null;
    let draggedMarker = null;
    let dragOffset = { x: 0, y: 0 };

    // Load image from file
    document.getElementById('imageInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        loadImage(url);
      }
    });

    // Load image from URL
    document.getElementById('loadUrl').addEventListener('click', () => {
      const url = document.getElementById('imageUrl').value.trim();
      if (url) loadImage(url);
    });

    // Load map shortcuts
    document.getElementById('loadEastAsia').addEventListener('click', () => {
      loadImage('asia-map-blank.png');
    });
    document.getElementById('loadKorea').addEventListener('click', () => {
      loadImage('korea-political.png');
    });
    document.getElementById('loadKoreaBlank').addEventListener('click', () => {
      loadImage('korea-outline.gif');
    });

    function loadImage(src) {
      if (mapImg) mapImg.remove();
      placeholder.style.display = 'none';

      mapImg = document.createElement('img');
      mapImg.className = 'map-img';
      mapImg.src = src;
      mapImg.onload = () => {
        container.insertBefore(mapImg, container.firstChild);
      };
      mapImg.onerror = () => {
        alert('Failed to load image');
        placeholder.style.display = 'flex';
      };
    }

    // Click to add marker
    container.addEventListener('click', (e) => {
      if (!mapImg || e.target.classList.contains('marker')) return;

      const rect = container.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(1);
      const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(1);

      addMarker(x, y);
    });

    function addMarker(x, y, label = '') {
      const id = markers.length + 1;
      const marker = {
        id,
        x: parseFloat(x),
        y: parseFloat(y),
        label: label || `Point ${id}`
      };
      markers.push(marker);

      // Create visual marker
      const el = document.createElement('div');
      el.className = 'marker';
      el.textContent = id;
      el.style.left = x + '%';
      el.style.top = y + '%';
      el.dataset.id = id;

      // Drag functionality
      el.addEventListener('mousedown', startDrag);

      container.appendChild(el);
      updateUI();
    }

    function startDrag(e) {
      e.stopPropagation();
      draggedMarker = e.target;
      draggedMarker.classList.add('dragging');

      const rect = draggedMarker.getBoundingClientRect();
      dragOffset.x = e.clientX - rect.left - rect.width / 2;
      dragOffset.y = e.clientY - rect.top - rect.height / 2;

      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', endDrag);
    }

    function drag(e) {
      if (!draggedMarker) return;

      const rect = container.getBoundingClientRect();
      let x = ((e.clientX - rect.left - dragOffset.x) / rect.width * 100);
      let y = ((e.clientY - rect.top - dragOffset.y) / rect.height * 100);

      // Clamp to bounds
      x = Math.max(0, Math.min(100, x));
      y = Math.max(0, Math.min(100, y));

      draggedMarker.style.left = x + '%';
      draggedMarker.style.top = y + '%';

      // Update marker data
      const id = parseInt(draggedMarker.dataset.id);
      const marker = markers.find(m => m.id === id);
      if (marker) {
        marker.x = parseFloat(x.toFixed(1));
        marker.y = parseFloat(y.toFixed(1));
        updateUI();
      }
    }

    function endDrag() {
      if (draggedMarker) {
        draggedMarker.classList.remove('dragging');
        draggedMarker = null;
      }
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', endDrag);
    }

    function updateUI() {
      // Update marker list
      if (markers.length === 0) {
        markerList.innerHTML = '<p style="color: #999; font-size: 12px;">Click on the map to add markers</p>';
      } else {
        markerList.innerHTML = markers.map(m => `
          <div class="marker-item">
            <span class="marker-num">${m.id}</span>
            <input type="text" value="${m.label}" onchange="updateLabel(${m.id}, this.value)" placeholder="Label">
            <span class="marker-coords">${m.x}%, ${m.y}%</span>
            <button class="marker-delete" onclick="deleteMarker(${m.id})">Ã—</button>
          </div>
        `).join('');
      }

      // Update CSS output
      if (markers.length === 0) {
        cssOutput.textContent = '<!-- No markers yet -->';
      } else {
        let css = markers.map(m =>
          `<!-- ${m.label} -->\n<span class="marker" style="top: ${m.y}%; left: ${m.x}%;">${m.id}</span>`
        ).join('\n\n');
        cssOutput.textContent = css;
      }
    }

    window.updateLabel = function(id, label) {
      const marker = markers.find(m => m.id === id);
      if (marker) {
        marker.label = label;
        updateUI();
      }
    };

    window.deleteMarker = function(id) {
      markers = markers.filter(m => m.id !== id);
      const el = container.querySelector(`.marker[data-id="${id}"]`);
      if (el) el.remove();

      // Renumber remaining markers
      markers.forEach((m, i) => {
        m.id = i + 1;
      });
      container.querySelectorAll('.marker').forEach((el, i) => {
        el.dataset.id = i + 1;
        el.textContent = i + 1;
      });

      updateUI();
    };

    // Clear all
    document.getElementById('clearAll').addEventListener('click', () => {
      if (markers.length === 0 || confirm('Clear all markers?')) {
        markers = [];
        container.querySelectorAll('.marker').forEach(el => el.remove());
        updateUI();
      }
    });

    // Copy CSS
    document.getElementById('copyCSS').addEventListener('click', () => {
      const text = cssOutput.textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('CSS copied to clipboard!');
      });
    });

    // Initialize
    updateUI();
  </script>
</body>
</html>
