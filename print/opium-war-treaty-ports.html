<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Opium War & Treaty Ports (1842)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        html, body { height: 100%; margin: 0; background: #f5f5f5; font-family: system-ui, -apple-system, sans-serif; }
        #map { height: 100%; width: 100%; }

        .city-label {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            font-size: 11px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }
        .city-label .han {
            font-size: 10px;
            color: #666;
            font-weight: 400;
        }

        .back-link {
            position: fixed;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 8px 14px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .back-link:hover { background: #fff; }
    </style>
</head>
<body>
    <a href="platebook-10.html" class="back-link">← Back to Plate 10</a>
    <div id="map"></div>

    <script>
        const map = L.map("map", { zoomControl: true, preferCanvas: true });

        // Light basemap from CARTO
        L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
            subdomains: "abcd",
            maxZoom: 12,
            minZoom: 4,
            attribution: '© OpenStreetMap © CARTO'
        }).addTo(map);

        // Locations with real coordinates
        const locations = {
            canton: {
                name: "Canton",
                han: "廣州",
                lat: 23.129,
                lng: 113.253,
                color: "#c41e3a",
                radius: 8,
                labelOffset: [12, -5]
            },
            hongkong: {
                name: "Hong Kong",
                han: "香港",
                lat: 22.32,
                lng: 114.17,
                color: "#7b2d8e",
                radius: 8,
                labelOffset: [12, 0]
            },
            shanghai: {
                name: "Shanghai",
                han: "上海",
                lat: 31.23,
                lng: 121.47,
                color: "#d35400",
                radius: 7,
                labelOffset: [10, -5]
            },
            xiamen: {
                name: "Xiamen",
                han: "廈門",
                lat: 24.48,
                lng: 118.09,
                color: "#d35400",
                radius: 6,
                labelOffset: [10, 0]
            },
            fuzhou: {
                name: "Fuzhou",
                han: "福州",
                lat: 26.075,
                lng: 119.308,
                color: "#d35400",
                radius: 6,
                labelOffset: [10, -5]
            },
            ningbo: {
                name: "Ningbo",
                han: "寧波",
                lat: 29.868,
                lng: 121.544,
                color: "#d35400",
                radius: 6,
                labelOffset: [10, 0]
            },
            nanjing: {
                name: "Nanjing",
                han: "南京",
                lat: 32.05,
                lng: 118.767,
                color: "#2874a6",
                radius: 7,
                labelOffset: [-60, -5]
            }
        };

        // Add markers and labels
        for (const key in locations) {
            const loc = locations[key];

            // Circle marker
            L.circleMarker([loc.lat, loc.lng], {
                radius: loc.radius,
                color: "#fff",
                weight: 2,
                fillColor: loc.color,
                fillOpacity: 0.9
            }).addTo(map);

            // Text label
            const labelIcon = L.divIcon({
                className: 'city-label',
                html: `${loc.name} <span class="han">${loc.han}</span>`,
                iconAnchor: [-loc.labelOffset[0], -loc.labelOffset[1]]
            });
            L.marker([loc.lat, loc.lng], { icon: labelIcon }).addTo(map);
        }

        // Draw coastal treaty port connections
        const coastalPorts = [
            [23.129, 113.253], // Canton
            [24.48, 118.09],   // Xiamen
            [26.075, 119.308], // Fuzhou
            [29.868, 121.544], // Ningbo
            [31.23, 121.47]    // Shanghai
        ];

        L.polyline(coastalPorts, {
            weight: 2,
            opacity: 0.4,
            dashArray: "6 4",
            color: "#d35400"
        }).addTo(map);

        // Fit map to show all locations with padding
        const bounds = L.latLngBounds([
            [20, 110],  // Southwest
            [34, 124]   // Northeast
        ]);
        map.fitBounds(bounds, { padding: [30, 30] });
    </script>
</body>
</html>
